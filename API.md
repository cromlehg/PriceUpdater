# Описание API

### Вызов AVI v1
Вызовы функций API v1 выполняются посредством отправки POST запроса в JSON формате на адрес /api/v1. При этом поле name в JSON данных должно содержать имя вызываемой функции.

#### Функции 

##### Создание комментария - ___postComment___
Создавать комментарий может только авторизованный пользователь.

Входные параметры

| поле          | req | Описание                                                                         | Тип  | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - postComment                                                        |string|         |
| content       | +   | содержание комментария                                                           |string|         |
| post_id       |     | на какой пост создается комментарий, если комментарий для поста, а не для комментария |Long  |         |
| comment_id    | +   | какой комментарий комментируем, если это не пост                                 |Long  |         |

В случае успеха возвращает комментарий в JSON формате.

##### Создание поста - ___createPost___
Создавать пост может только авторизованный пользователь.

Входные параметры

| поле          | req | Описание                                                                         | Тип  | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - createPost                                                         |string|         |
| title         | +   | заголовок поста                                                                  |string| > 3     |
| content       | +   | содержание поста                                                                 |string| > 256   |
| thumbnail     |     | URL миниатюры                                                                    |string|         |
| reward_type   | +   | способ награды за размещение "50 power/50 dollars" или "power"                   |string|         |
| post_type     | +   | тип поста: "review" - отзыв или "article" - статья                               |string|         |
| limit         |     | сколько нужно собрать, если пост - мечта                                         |long  |         |
| tags          |     | тэги, не более AppConstants.Limit (сейчас 4), каждый более 3 символов            |array[string]  |         |

В случае успеха возвращает пост в JSON формате.

##### Получение списка постов - ___getPosts___
Возвращает список постов

Входные параметры

| поле          | req | Описание                                                                         | Тип  | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - getPosts                                                           |string|         |
| page_id       | +   | номер страницы                                                                   |Int   |         |
| user_id       |     | если указан id пользователя, то возвращаются посты только этого пользователя (login тогда не нужен)                                                                  |Long  |         |
| login         |     | если указан login пользователя, то возвращаются посты только этого пользователя (user_id тогда не нужен)                                                                   |Long  |         |
| filter        |     | "New" или "Trending" или "Hot" или "Promouted"                                   |string|         |
| tags          |     | массив тэгов для поиска, не более 4-ех и каждый не короче 3-ех символов          |Array[string]|         |

В случае успеха возвращает список постов в JSON формате. В случае отсутсвия поля filter возвращает посты отсортированные по идентификатору.

##### Получение списка транзакций для авторизованного пользователя - ___getTransactions___
Возвращает список транзакций

Входные параметры

| поле          | req | Описание                                                                         | Тип   | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:------|:--------|
| name          | +   | имя функции - getTransactions                                                    |string |         |
| page_id       | +   | номер страницы                                                                   |Int    |         |
| is_schelduled |     | если указано и true, то возвращает список запланированных транзакций             |Boolean|         |

В случае успеха возвращает список транзакций в JSON формате. 

##### Обновление информации "о себе" авторизованного пользователя - ___updateUserAbout___
Возвращает Ok в случае успеха

Входные параметры

| поле          | req | Описание                                                                         | Тип  | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - updateUserAbout                                                    |string|         |
| value         | +   | новая информация "о себе"                                                        |string|         |


##### Обновление имени авторизованного пользователя - ___updateUserName___
Возвращает Ok в случае успеха

Входные параметры

| поле          | req | Описание                                                                         | Тип  | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - updateUserName                                                     |string|         |
| value         | +   | новое имя                                                                        |string|         |

##### Обновление фамилии авторизованного пользователя - ___updateUserSurname___
Возвращает Ok в случае успеха

Входные параметры

| поле          | req | Описание                                                                         | Тип  | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - updateUserSurname                                                  |string|         |
| value         | +   | новая фамилия                                                                    |string|         |

##### Обновление аватарки авторизованного пользователя - ___updateUserAvatar___
Возвращает Ok в случае успеха

Входные параметры

| поле          | req | Описание                                                                         | Тип  | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - updateUserAvatar                                                   |string|         |
| value         | +   | url нового аватара                                                               |string|         |

##### Обновление фона авторизованного пользователя - ___updateUserBackground___
Возвращает Ok в случае успеха

Входные параметры

| поле          | req | Описание                                                                         | Тип  | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - updateUserBackground                                               |string|         |
| value         | +   | url нового фона                                                                  |string|         |

##### Получение комментариев - ___getComments___
Получение комментариев

Варианты вызова

| поле          | req | Описание                                                                         | Тип  | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - getComments                                                        |string|         |
| post_id       | +   | номер поста, по которому будем получать __дерево__ комментариев. Иные параметры при указании данного не требуются                                                                   |Int   |         |
| view_type     |     | если указан и укзан tree, тов овзращает дерево, иначе список                     |string|         |

В случае успеха вернет список комментариев с древовидной структурой. Список содержит все комментарии первого уровня. Далее вложенные комментарии находятся в полях nested.

или

| поле          | req | Описание                                                                         | Тип  | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - getComments                                                        |string|         |
| user_id       |     | id пользовтателя для всех постов которого будем получать __список__ комментариев (тогда login не требуется)                                                                   |Int   |         |
| login         |     | login пользовтателя для всех постов которого будем получать __список__ комментариев (тогда user_id не требуется)                                                                   |Int   |         |
| page_id       | +   | Номер страницы актуален только для списка комментариев 

В случае успеха возвращает cписок комментариев по всем постам пользователя user_id

##### Получение информации о авторизованном пользователе - ___getUser___
Возвращает инфоррмацию об авторизованном пользователе в формате JSON 

Входные параметры

| поле          | req | Описание                                                        | Тип  | Условия |
|:--------------|:---:|:----------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - getUser                                           |string|         |

##### Получение не конфиденциальной информации о пользователе - ___getUserInfo___
Возвращает не конфиденциальную инфоррмацию о пользователе в формате JSON 

Входные параметры

| поле          | req | Описание                                                        | Тип  | Условия |
|:--------------|:---:|:----------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - getUserInfo                                       |string|         |
| user_id       | ?   | id пользователя, если хотим получить информацию по id           |Long  |         |
| login         | ?   | логин пользователя, если хотим получать информацию по логину    |string|         |

##### Проверка зарегистрирован ли логин - ___isLoginExists___
Возвращает true если логин уже зарегистрирован. 

Входные параметры

| поле          | req | Описание                                                        | Тип  | Условия |
|:--------------|:---:|:----------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - isUserExists                                      |string|         |
| login         | +   | логин, существованине которго проверяем                         |string|         |

##### Проверка зарегистрирован ли email - ___isEmailExists___
Возвращает true если email уже зарегистрирован. 

Входные параметры

| поле          | req | Описание                                                        | Тип  | Условия |
|:--------------|:---:|:----------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - isEmailExists                                     |string|         |
| email         | +   | email, существованине которго проверяем                         |string|         |

##### Лайк поста/комментария - ___like___
Возвращает лайк в виде JSON, если все ок 

Входные параметры

| поле          | req | Описание                                                        | Тип  | Условия |
|:--------------|:---:|:----------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - like                                              |string|         |
| post_id       |     | id поста, который лайкаем (тогда comment_id не нужен)           |Long  |         |
| comment_id    |     | id комментария, который лайкаем (тогда post_id не нужен)        |Long  |         |

##### Полнотекстовый поиск - ___search___
Возвращает список найденых постов в виде JSON  

Входные параметры

| поле          | req | Описание                                                        | Тип  | Условия |
|:--------------|:---:|:----------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - search                                            |string|         |
| page_id       |     | номер страницы с найденными постами                             |Long  |         |
| text          |     | вхождение, которое ищем в заголовке или контенте (может быть паттерн полнотекстового поиска)        |string|         |

##### Получить пост по id - ___getPost___
Возвращает пост в виде JSON  

Входные параметры

| поле          | req | Описание                                                        | Тип  | Условия |
|:--------------|:---:|:----------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - getPost                                           |string|         |
| post_id       | +   | id поста, который хотим получить                                |Long  |         |

##### Перевести валюту от авторизованного пользователя к указанному - ___transfer___
Возвращает транзакцию в виде JSON  

Входные параметры

| поле          | req | Описание                                                        | Тип  | Условия |
|:--------------|:---:|:----------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - transfer                                          |string|         |
| user_id       | ?   | id пользователя, если хотим отправить пользовтаелю по id        |Long  |         |
| login         | ?   | логин пользователя, если хотим отправить пользователю по логину |string|         |
| currency      | +   | тип отправляемой валюты                                         |string|         |
| value         | +   | сколко отправляем (без запятой перед дробной частью)            |Long  |         |
| msg           |     | сообщение                                                       |string| < 100   |

##### Продвинуть пост в категории top - ___promote___
Возвращает транзакцию в виде JSON  

Входные параметры

| поле          | req | Описание                                                              | Тип  | Условия |
|:--------------|:---:|:----------------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - promote                                                 |string|         |
| post_id       | +   | id поста, который будем продвигать                                    |Long  |         |
| value         | +   | сколко отправляем DOLLARS для продвижения (без запятой в дроби)       |Long  |         |
| msg           |     | сообщение                                                             |string| < 100   |

##### Обмен валют - ___exchange___
Возвращает OK если обмен начат или совершен  

Входные параметры

| поле          | req | Описание                                                                 | Тип  | Условия |
|:--------------|:---:|:-------------------------------------------------------------------------|:-----|:--------|
| name          | +   | имя функции - exchange                                                   |string|         |
| currency_from | +   | валюта которую будем обменивать                                          |string|         |
| currency_to   | +   | валюта, на которую будем менять                                          |string|         |
| value         | +   | сколько валюты currency_from будем менять                                |Long  |         |

##### Исполнить запланированную транзакцию - ___approveTransaction___
Возвращает транзакцию в случае успеха в JSON формате 

Входные параметры

| поле           | req | Описание                                                                 | Тип  | Условия |
|:---------------|:---:|:-------------------------------------------------------------------------|:-----|:--------|
| name           | +   | имя функции - approveTransaction                                         |string|         |
| transaction_id | +   | Идентификатор исполняемой транзакции                                     |Long  |         |

##### Получение списка тэгов - ___getTags___
Возвращает список транзакций

Входные параметры

| поле          | req | Описание                                                                         | Тип   | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:------|:--------|
| name          | +   | имя функции - getTags                                                            |string |         |
| page_id       | +   | номер страницы                                                                   |Int    |         |

##### Верификация почты и установка пароля - ___verifyEmail___
Возвращает пользователя

Входные параметры

| поле          | req | Описание                                                                         | Тип   | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:------|:--------|
| name          | +   | имя функции - verifyEmail                                                        |string |         |
| login         | +   | логин пользователя                                                               |string |         |
| code          | +   | код верификации                                                                  |string |         |
| pwd           | +   | пароль - не менее 10 символов                                                    |string |         |

##### Проверка на необходимость верификации по коду и логину - ___needsVerify___
Возвращает пользователя в случае необходимости верификации

Входные параметры

| поле          | req | Описание                                                                         | Тип   | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:------|:--------|
| name          | +   | имя функции - needsVerify                                                        |string |         |
| login         | +   | логин пользователя                                                               |string |         |
| code          | +   | код верификации                                                                  |string |         |

##### Отключает показ брэнд-инфы для авторизованного пользователя - ___disableShowBrand___
Возвращает Ok в случае успеха

Входные параметры

| поле          | req | Описание                                                                         | Тип   | Условия |
| ------------- |:---:|:---------------------------------------------------------------------------------|:------|:--------|
| name          | +   | имя функции - disableShowBrand                                                   |string |         |


